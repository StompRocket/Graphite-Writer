function GetURLParameter(e){for(var t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++){var o=t[a].split("=");if(o[0]==e)return o[1]}}var toolbarOptions=[[{font:[]}],[{size:[]}],["bold","italic","underline","strike"],["blockquote","link","code-block","image"],[{color:[]},{background:[]}],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["clean"]];$(document).ready(function(e){document.addEventListener("scroll",function(t){e("#deleteDoc").offset().top<1?(console.log("triggerd"),e(".ql-toolbar").css("width","100%"),e(".ql-toolbar").css("z-index","999"),e(".ql-toolbar").css("top","0"),e(".ql-toolbar").css("position","fixed"),e(".ql-toolbar").css("margin-left","-5%")):(e(".ql-toolbar").css("margin","0px"),e(".ql-toolbar").css("top","initial"),e(".ql-toolbar").css("position","static"))},!0),firebase.auth().onAuthStateChanged(function(a){function o(e){var a=t.getContents();return e=JSON.stringify(a),e=sjcl.encrypt(r,e)}function n(e){return e=sjcl.decrypt(r,e),JSON.parse(e)}function i(t){e("#saving").text("Saving...");var a=new Date;a=a.toString(),a=a.split(" ").slice(0,5).join(" "),firebase.database().ref("users/"+r+"/docsStorage/"+documentname+"/").set({data:o(t),title:e("#doctitle").text(),date:a,utcdate:(new Date).getTime(),enc:!0,version:2}).then(()=>{e("#saving").text("Saved");e("#lastedited").text(a)}),firebase.database().ref("users/"+r+"/docs/"+documentname+"/").set({data:"",title:e("#doctitle").text(),date:a,utcdate:(new Date).getTime(),enc:!0,version:2});var n=window.location.href;if(1==n.substr(n.lastIndexOf("=")+1)){var i={foo:"bar"};n=n.slice(0,-1)+"2",history.pushState(i,"page 2",n)}}function s(){i(t.getContents())}if(a){var r;null!=(a=firebase.auth().currentUser)&&(a.displayName,a.email,a.photoURL,a.emailVerified,r=a.uid);const o=GetURLParameter("d"),d=GetURLParameter("v");e("#share").on("click",()=>{var a=firebase.database().ref("shared/"+r+"/docs/"+o);var n=new Date;n=n.toString();n=n.split(" ").slice(0,5).join(" ");a.set({data:t.getContents(),title:e("#doctitle").text(),date:n});e("#shareLink").text("graphitewriter.com/shared?u="+r+"&d="+o);e("#shareLink").attr("href","https://graphitewriter.com/shared?u="+r+"&d="+o);e("#shareModal").addClass("is-active");e(".close-share").on("click",()=>{e("#shareModal").removeClass("is-active")})}),function(){if(2==d)var a=firebase.database().ref("users/"+r+"/docsStorage/"+o+"/");else a=firebase.database().ref("users/"+r+"/docs/"+o+"/");console.log(a),a.once("value").then(function(a){var o=a.val().data,i=a.val().title,s=a.val().date,r=a.val().enc;console.log(s+"date"),null!=s&&"undefined"!=s||(window.location.href="/app"),s=s.split(" ").slice(0,5).join(" "),e("#lastedited").text(s),e("#doctitle").text(i),document.title=i,r?t.setContents(n(o)):t.setContents(o),e("#loader").hide(),e("#doccontainer").fadeIn()})}(),window.onbeforeunload=function(){if("Saved"!==e("#saving").text())return i(t.getContents()),"Your document has not been saved please wait untill it has finished"};var l;e("#doctitle").on("keyup",function(){e("#saving").text("Waiting..."),clearTimeout(l),l=setTimeout(s,2e3)});var c=1;t.update(),t.on("text-change",function(t,a,o){1===c?c++:(e("#saving").text("Waiting..."),clearTimeout(l),l=setTimeout(s,2e3))}),e("#deleteDoc").on("click",()=>{var e=confirm("Are you sure you want to delete this document?");if(1==e){var t={};t["users/"+r+"/docs/"+o]=null,t["users/"+r+"/docsStorage/"+o]=null,firebase.database().ref().update(t),window.location.href="/app"}}),e(document).keydown(function(a){if((a.ctrlKey||a.metaKey)&&83==a.which){a.preventDefault();var o=t.getContents();e("#title").text();return i(o),!1}})}});var t=new Quill("#editor",{modules:{toolbar:toolbarOptions},placeholder:"Compose an epic...",theme:"snow"});t.theme.tooltip.root.querySelector("input[data-link]").dataset.link="https://www.google.com"});