function GetURLParameter(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e)return o[1]}}var toolbarOptions=[[{font:[]}],[{size:[]}],["bold","italic","underline","strike"],["blockquote","link","code-block","image"],[{color:[]},{background:[]}],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["clean"]];$(document).ready(function(e){NProgress.configure({showSpinner:!1}),document.addEventListener("scroll",function(t){e("#deleteDoc").offset().top<1?(console.log("triggerd"),e(".ql-toolbar").css("width","100%"),e(".ql-toolbar").css("z-index","999"),e(".ql-toolbar").css("top","0"),e(".ql-toolbar").css("position","fixed"),e(".ql-toolbar").css("margin-left","-5%")):(e(".ql-toolbar").css("margin","0px"),e(".ql-toolbar").css("top","initial"),e(".ql-toolbar").css("position","static"))},!0),firebase.auth().onAuthStateChanged(function(n){function o(e){var n=t.getContents();return e=JSON.stringify(n),e=sjcl.encrypt(s,e)}function a(e){return e=sjcl.decrypt(s,e),JSON.parse(e)}function i(t){e("#saving").text("Saving...");var n=new Date;n=n.toString(),n=n.split(" ").slice(0,5).join(" "),firebase.database().ref("users/"+s+"/docs/"+documentname+"/").set({data:o(t),title:e("#doctitle").text(),date:n,utcdate:(new Date).getTime(),enc:!0}).then(()=>{e("#saving").text("Saved");e("#lastedited").text(n)})}function r(){i(t.getContents())}if(n){var s;null!=(n=firebase.auth().currentUser)&&(n.displayName,n.email,n.photoURL,n.emailVerified,s=n.uid);const o=GetURLParameter("d");e("#share").on("click",()=>{var n=firebase.database().ref("shared/"+s+"/docs/"+o);var a=new Date;a=a.toString();a=a.split(" ").slice(0,5).join(" ");n.set({data:t.getContents(),title:e("#doctitle").text(),date:a});e("#shareLink").text("graphitewriter.com/shared?u="+s+"&d="+o);e("#shareLink").attr("href","http://graphitewriter.com/shared?u="+s+"&d="+o);e("#shareModal").addClass("is-active");e(".close-share").on("click",()=>{e("#shareModal").removeClass("is-active")})}),function(){firebase.database().ref("users/"+s+"/docs/"+o+"/").once("value").then(function(n){var o=n.val().data,i=n.val().title,r=n.val().date,s=n.val().enc;console.log(r+"date"),null!=r&&"undefined"!=r||(window.location.href="/app"),r=r.split(" ").slice(0,5).join(" "),e("#lastedited").text(r),e("#doctitle").text(i),document.title=i,s?t.setContents(a(o)):t.setContents(o),e("#loader").hide(),e("#doccontainer").fadeIn()})}(),window.onbeforeunload=function(){if("Saved"!==e("#saving").text())return i(t.getContents()),"Your document has not been saved please wait untill it has finished"};var l;e("#doctitle").on("keyup",function(){e("#saving").text("Waiting..."),clearTimeout(l),l=setTimeout(r,2e3)});var c=1;t.update(),t.on("text-change",function(t,n,o){1===c?c++:(e("#saving").text("Waiting..."),clearTimeout(l),l=setTimeout(r,2e3))}),e("#deleteDoc").on("click",()=>{var e=confirm("Are you sure you want to delete this document?");if(1==e){var t={};t["users/"+s+"/docs/"+o]=null,firebase.database().ref().update(t),window.location.href="/app"}}),e(document).keydown(function(n){if((n.ctrlKey||n.metaKey)&&83==n.which){n.preventDefault();var o=t.getContents();e("#title").text();return i(o),!1}})}});var t=new Quill("#editor",{modules:{toolbar:toolbarOptions},placeholder:"Compose an epic...",theme:"snow"});t.theme.tooltip.root.querySelector("input[data-link]").dataset.link="https://www.google.com"});