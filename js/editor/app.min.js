function GetURLParameter(e){for(var t=window.location.search.substring(1).split("&"),o=0;o<t.length;o++){var n=t[o].split("=");if(n[0]==e)return n[1]}}var toolbarOptions=[[{font:[]}],[{size:[]}],["bold","italic","underline","strike"],["blockquote","link","code-block","image"],[{color:[]},{background:[]}],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["clean"]];$(document).ready(function(e){e("#doccontainer").hide(),document.addEventListener("scroll",function(t){e("#deleteDoc").offset().top<1?(console.log("triggerd"),e(".ql-toolbar").css("width","100%"),e(".ql-toolbar").css("z-index","999"),e(".ql-toolbar").css("top","0"),e(".ql-toolbar").css("position","fixed"),e(".ql-toolbar").css("margin-left","-5%")):(e(".ql-toolbar").css("margin","0px"),e(".ql-toolbar").css("top","initial"),e(".ql-toolbar").css("position","static"))},!0),firebase.auth().onAuthStateChanged(function(o){function n(e){var o=t.getContents();return e=JSON.stringify(o),e=sjcl.encrypt(s,e)}function a(e){return e=sjcl.decrypt(s,e),JSON.parse(e)}function i(t){e("#saving").text("Saving...");var o=new Date;o=o.toString(),o=o.split(" ").slice(0,5).join(" "),firebase.database().ref("users/"+s+"/docs/"+documentname+"/").set({data:n(t),title:e("#doctitle").text(),date:o,utcdate:(new Date).getTime(),enc:!0}).then(()=>{e("#saving").text("Saved");e("#lastedited").text(o)})}function r(){i(t.getContents())}if(o){var s;null!=(o=firebase.auth().currentUser)&&(o.displayName,o.email,o.photoURL,o.emailVerified,s=o.uid);const n=GetURLParameter("d");e("#share").on("click",()=>{var o=firebase.database().ref("shared/"+s+"/docs/"+n);var a=new Date;a=a.toString();a=a.split(" ").slice(0,5).join(" ");o.set({data:t.getContents(),title:e("#doctitle").text(),date:a});e("#shareLink").text("graphitewriter.com/shared?u="+s+"&d="+n);e("#shareLink").attr("href","http://graphitewriter.com/shared?u="+s+"&d="+n);e("#shareModal").addClass("is-active");e(".close-share").on("click",()=>{e("#shareModal").removeClass("is-active")})}),function(){firebase.database().ref("users/"+s+"/docs/"+n+"/").once("value").then(function(o){var n=o.val().data,i=o.val().title,r=o.val().date,s=o.val().enc;console.log(r+"date"),null!=r&&"undefined"!=r||(window.location.href="/app"),r=r.split(" ").slice(0,5).join(" "),e("#lastedited").text(r),e("#doctitle").text(i),document.title=i,s?t.setContents(a(n)):t.setContents(n),e("#loader").hide(),e("#doccontainer").fadeIn()})}(),window.onbeforeunload=function(){if("Saved"!==e("#saving").text())return i(t.getContents()),"Your document has not been saved please wait untill it has finished"};var l,c=1;t.update(),t.on("text-change",function(t,o,n){1===c?c++:(e("#saving").text("Waiting..."),clearTimeout(l),l=setTimeout(r,2e3))}),e("#doctitle").on("keyup",e=>{var o=t.getContents();console.log(o);i(o)}),e("#deleteDoc").on("click",()=>{var e=confirm("Are you sure you want to delete this document?");if(1==e){var t={};t["users/"+s+"/docs/"+n]=null,firebase.database().ref().update(t),window.location.href="/app"}}),e(document).keydown(function(o){if((o.ctrlKey||o.metaKey)&&83==o.which){o.preventDefault();var n=t.getContents();e("#title").text();return i(n),!1}})}});var t=new Quill("#editor",{modules:{toolbar:toolbarOptions},placeholder:"Compose an epic...",theme:"snow"});t.theme.tooltip.root.querySelector("input[data-link]").dataset.link="https://www.google.com"});