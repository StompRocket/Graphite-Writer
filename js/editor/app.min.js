function GetURLParameter(t){for(var e=window.location.search.substring(1).split("&"),n=0;n<e.length;n++){var o=e[n].split("=");if(o[0]==t)return o[1]}}var toolbarOptions=[[{font:[]}],[{size:[]}],["bold","italic","underline","strike"],["blockquote","link","code-block","image"],[{color:[]},{background:[]}],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["clean"]];$(document).ready(function(t){document.addEventListener("scroll",function(e){t("#deleteDoc").offset().top<1?(console.log("triggerd"),t(".ql-toolbar").css("width","100%"),t(".ql-toolbar").css("z-index","999"),t(".ql-toolbar").css("top","0"),t(".ql-toolbar").css("position","fixed"),t(".ql-toolbar").css("margin-left","-5%")):(t(".ql-toolbar").css("margin","0px"),t(".ql-toolbar").css("top","initial"),t(".ql-toolbar").css("position","static"))},!0),firebase.auth().onAuthStateChanged(function(n){function o(t){var n=e.getContents();return t=JSON.stringify(n),t=sjcl.encrypt(r,t)}function a(t){return t=sjcl.decrypt(r,t),JSON.parse(t)}function i(e){t("#saving").text("Saving...");var n=new Date;n=n.toString(),n=n.split(" ").slice(0,5).join(" "),firebase.database().ref("users/"+r+"/docs/"+documentname+"/").set({data:o(e),title:t("#doctitle").text(),date:n,utcdate:(new Date).getTime(),enc:!0}).then(()=>{t("#saving").text("Saved");t("#lastedited").text(n)})}function s(){i(e.getContents())}if(n){var r;null!=(n=firebase.auth().currentUser)&&(n.displayName,n.email,n.photoURL,n.emailVerified,r=n.uid);const o=GetURLParameter("d");t("#share").on("click",()=>{var n=firebase.database().ref("shared/"+r+"/docs/"+o);var a=new Date;a=a.toString();a=a.split(" ").slice(0,5).join(" ");n.set({data:e.getContents(),title:t("#doctitle").text(),date:a});t("#shareLink").text("graphitewriter.com/shared?u="+r+"&d="+o);t("#shareLink").attr("href","https://graphitewriter.com/shared?u="+r+"&d="+o);t("#shareModal").addClass("is-active");t(".close-share").on("click",()=>{t("#shareModal").removeClass("is-active")})}),function(){firebase.database().ref("users/"+r+"/docs/"+o+"/").once("value").then(function(n){var o=n.val().data,i=n.val().title,s=n.val().date,r=n.val().enc;console.log(s+"date"),null!=s&&"undefined"!=s||(window.location.href="/app"),s=s.split(" ").slice(0,5).join(" "),t("#lastedited").text(s),t("#doctitle").text(i),document.title=i,r?e.setContents(a(o)):e.setContents(o),t("#loader").hide(),t("#doccontainer").fadeIn()})}(),window.onbeforeunload=function(){if("Saved"!==t("#saving").text())return i(e.getContents()),"Your document has not been saved please wait untill it has finished"};var l;t("#doctitle").on("keyup",function(){t("#saving").text("Waiting..."),clearTimeout(l),l=setTimeout(s,2e3)});var c=1;e.update(),e.on("text-change",function(e,n,o){1===c?c++:(t("#saving").text("Waiting..."),clearTimeout(l),l=setTimeout(s,2e3))}),t("#deleteDoc").on("click",()=>{var t=confirm("Are you sure you want to delete this document?");if(1==t){var e={};e["users/"+r+"/docs/"+o]=null,firebase.database().ref().update(e),window.location.href="/app"}}),t(document).keydown(function(n){if((n.ctrlKey||n.metaKey)&&83==n.which){n.preventDefault();var o=e.getContents();t("#title").text();return i(o),!1}})}});var e=new Quill("#editor",{modules:{toolbar:toolbarOptions},placeholder:"Compose an epic...",theme:"snow"});e.theme.tooltip.root.querySelector("input[data-link]").dataset.link="https://www.google.com"});